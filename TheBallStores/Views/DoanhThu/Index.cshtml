@using TheBallStores.Models
@{
    ViewData["Title"] = "Doanh Thu";
    var lastOrders = ViewBag.LastOrders as List<DonHang> ?? new List<DonHang>();
}

<h1 class="text-info mb-4">Doanh Thu</h1>
<p class="text-muted">Tổng quan hiệu suất kinh doanh.</p>
<hr class="border-secondary" />

<div class="row g-4 mb-5">
    <!-- Thẻ 1: DOANH THU THỰC TẾ -->
    <div class="col-md-4">
        <div class="card-vortex p-4 text-center h-100">
            <h3 class="text-success fw-bold">@((ViewBag.TotalRevenue as decimal? ?? 0).ToString("#,##0")) VNĐ</h3>
            <p class="text-muted mb-0">DOANH THU THỰC TẾ (Đã hoàn thành)</p>
        </div>
    </div>
    <!-- Thẻ 2: TỔNG ĐƠN HÀNG -->
    <div class="col-md-4">
        <div class="card-vortex p-4 text-center h-100">
            <h3 class="text-info fw-bold">@(ViewBag.TotalOrders ?? 0)</h3>
            <p class="text-muted mb-0">TỔNG SỐ ĐƠN HÀNG</p>
        </div>
    </div>
    <!-- Thẻ 3: CẦN XỬ LÝ -->
    <div class="col-md-4">
        <div class="card-vortex p-4 text-center h-100 border-warning">
            <h3 class="text-warning fw-bold">@(ViewBag.NewOrders ?? 0)</h3>
            <p class="text-muted mb-0">ĐƠN CẦN XỬ LÝ NGAY</p>
        </div>
    </div>
</div>

<h4 class="text-white mb-3">ĐƠN HÀNG GẦN NHẤT</h4>
<div class="card-vortex p-0 overflow-hidden">
    <table class="table table-dark table-striped table-hover mb-0">
        <thead>
            <tr>
                <th>Mã ĐH</th>
                <th>Khách hàng</th>
                <th>Ngày đặt</th>
                <th>Tổng tiền</th>
                <th>Trạng thái</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var order in lastOrders)
            {
                <tr>
                    <td class="text-muted">#@order.MaDonHang</td>
                    <td class="text-info">@(order.TenNguoiNhan ?? "Khách vãng lai")</td>
                    <td class="text-muted">@(order.NgayDat.HasValue ? order.NgayDat.Value.ToString("dd/MM/yyyy HH:mm") : "")</td>
                    <td class="text-success fw-bold">@(order.TongTien.HasValue ? order.TongTien.Value.ToString("#,##0") : "0") đ</td>
                    <td>
                        @if (order.TrangThai.Contains("Mới") || order.TrangThai.Contains("Chờ"))
                        {
                            <span class="badge bg-warning text-dark">@order.TrangThai</span>
                        }
                        else if (order.TrangThai == "Hoàn thành")
                        {
                            <span class="badge bg-success">@order.TrangThai</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">@order.TrangThai</span>
                        }
                    </td>
                    <td>
                        <a asp-controller="DonHangs" asp-action="Details" asp-route-id="@order.MaDonHang" class="btn btn-sm btn-outline-info">Xem</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>