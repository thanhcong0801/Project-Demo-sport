@model IEnumerable<TheBallStores.Models.DonHang>

@{
    ViewData["Title"] = "Quản Lý Đơn Hàng";
    var totalOrders = Model.Count();
}

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-uppercase text-dark mb-0">Quản Lý Đơn Hàng</h2>
            <p class="text-muted small mb-0">Tổng số: <span class="fw-bold text-primary">@totalOrders</span> đơn hàng</p>
        </div>
        <a asp-controller="Admin" asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i> Dashboard
        </a>
    </div>

    <!-- Table Card -->
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light text-secondary text-uppercase small fw-bold">
                        <tr>
                            <th class="ps-4 py-3" style="width: 10%;">Mã ĐH</th>
                            <th class="py-3" style="width: 20%;">Khách Hàng</th>
                            <th class="py-3" style="width: 15%;">Ngày Đặt</th>
                            <th class="py-3 text-end" style="width: 15%;">Tổng Tiền</th>
                            <th class="py-3 text-center" style="width: 20%;">Trạng Thái</th>
                            <th class="py-3 text-end pe-4" style="width: 20%;">Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model)
                        {
                            var badgeClass = order.TrangThai switch
                            {
                                "Hoàn thành" or "Đã thanh toán (VNPay)" => "bg-success bg-opacity-10 text-success border border-success",
                                "Đã hủy" or "Hủy (Lỗi thanh toán)" => "bg-danger bg-opacity-10 text-danger border border-danger",
                                "Chờ thanh toán" or "Mới đặt (COD)" => "bg-warning text-dark border border-warning-subtle",
                                _ => "bg-info bg-opacity-10 text-info border border-info"
                            };

                            <tr>
                                <td class="ps-4">
                                    <a asp-controller="DonHangs" asp-action="Details" asp-route-id="@order.MaDonHang" class="fw-bold text-primary text-decoration-none">
                                        #@order.MaDonHang
                                    </a>
                                </td>
                                <td>
                                    <div class="fw-bold text-dark">@(order.MaKhNavigation?.HoTen ?? "Khách vãng lai")</div>
                                    <small class="text-muted">@(order.TenNguoiNhan ?? "")</small>
                                </td>
                                <td class="text-muted small">
                                    @order.NgayDat?.ToString("dd/MM/yyyy HH:mm")
                                </td>
                                <td class="text-end fw-bold text-dark">
                                    @(order.TongTien?.ToString("#,##0") ?? "0") đ
                                </td>
                                <td class="text-center">
                                    <span class="badge @badgeClass px-3 py-2 rounded-pill fw-normal">
                                        @order.TrangThai
                                    </span>
                                </td>
                                <td class="text-end pe-4">
                                    <div class="btn-group">
                                        <a asp-controller="DonHangs" asp-action="Details" asp-route-id="@order.MaDonHang" class="btn btn-sm btn-outline-primary" title="Xem chi tiết">
                                            <i class="bi bi-eye"></i> Xem
                                        </a>
                                        <!-- Admin có thể cập nhật trạng thái trong trang chi tiết, nút hủy ở đây disable -->
                                        @if (!order.TrangThai.Contains("Hủy") && !order.TrangThai.Contains("Hoàn thành"))
                                        {
                                            <button class="btn btn-sm btn-outline-secondary" disabled title="Vào chi tiết để xử lý"><i class="bi bi-pencil-square"></i></button>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            @if (!Model.Any())
            {
                <div class="text-center py-5">
                    <div class="mb-3 text-muted opacity-25">
                        <i class="bi bi-inbox" style="font-size: 4rem;"></i>
                    </div>
                    <p class="text-muted mb-0">Chưa có đơn hàng nào.</p>
                </div>
            }
        </div>
    </div>
</div>